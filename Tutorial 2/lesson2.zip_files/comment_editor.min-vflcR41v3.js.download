define(["require","exports","tslib","react","spectrum_comments/comment_avatar","spectrum_comments/comment_editor/core/scope_component","spectrum_comments/comment_editor/types","react","classnames","spectrum_comments/comment_editor/core/scope_container","spectrum_comments/comment_editor/components/draft_composer","spectrum_comments/comment_editor/reducers","draft-js","spectrum_comments/comment_editor/components/post_signal","spectrum_comments/comment_editor/core/utils","spectrum_comments/comment_editor/core/composer_wrappers","spectrum_comments/comment_editor/comment_utils","spectrum_comments/comment_editor/macros/mentions_macro_composers"],function(e,t,o,n,r,s,c,a,m,i,p,u,d,l,g,f,S,h){"use strict";function C(e,t){return g.completeScope(E,e,t)}function _(e){var t=e.innerProps,o=(e.kernel,e.status),n=e.scopeTriggers,r=t.prevStatus;r&&o.draft.editorState===r.draft.editorState||n.draft.change(o.draft.editorState)}function v(e){var t=e.status,o=e.scopeTriggers,n=(e.innerProps,e.kernel);t.comment&&(o.draft.init(t.comment.content),n.compose(function(e){var t=d.EditorState.set(e.status.draft.editorState,{decorator:new d.CompositeDecorator(e.status.draft.decorators)});o.draft.change(t)}))}function y(e){var t=(e.status,e.scopeTriggers),o=(e.innerProps,e.kernel),n=o.compose(h.getSuggestedMentionUsers);n&&t.suggestion.updateTotalSuggestions(n.length)}Object.defineProperty(t,"__esModule",{value:!0});var E={draft:c.DraftNames,comment:c.CommentNames,macro:c.MacroNames,suggestion:c.SuggestionSelectionNames,mentionSuggestions:c.MentionSuggestionNames},R=(function(e){function t(t){var o=e.call(this,t)||this;return o.container=o.createCommentEditorScopeContainer(),o}return o.__extends(t,e),t.prototype.createBaseScope=function(e){return C(this.createBaseReducers().concat(e||[]),[{draft:_,comment:v,mentionSuggestions:y}])},t.prototype.createCommentEditorScopeContainer=function(){var e=new i.ScopeContainerImpl({scopeNames:E,defaultStatus:{draft:{editorState:d.EditorState.createEmpty(),readOnly:!1,placeholder:this.props.placeholder,decorators:[]},comment:S.createCommentStatusFromContent(this.props.content),macro:{active:{content:"",type:"",entityKey:""}},suggestion:{selectedIndex:-1,totalSuggestions:0},mentionSuggestions:{userMap:this.props.mentionsMatches||{}}}});return e.compose(v,C(this.createBaseReducers(),[]),{}),e},t.prototype.createBaseReducers=function(){var e=this.props.onMentionsQueryUpdated||function(){};return[u.interactionReducers(),u.textReducers(),u.styleReducers()].concat(u.macrosReducers({onMentionSuggestionsQuery:e}),[u.suggestionReducers(),u.mentionReducers()])},t.prototype.componentWillReceiveProps=function(e){var t=e.onContentChange,o=void 0===t?function(){}:t,n=e.onCancel,r=e.onPost,s={onContentChange:o,onCancel:n,onPost:r};e.content.text!==this.container.getStatus().comment.content.text&&this.container.updateStatus({comment:S.createCommentStatusFromContent(e.content)},this.createBaseScope([u.publishReducers(s)])),e.mentionsMatches!==this.props.mentionsMatches&&this.container.updateStatus({mentionSuggestions:{userMap:e.mentionsMatches}},this.createBaseScope([u.publishReducers(s)]))},t.prototype.render=function(){var e=this.props,t=e.postSignalComponent,o=void 0===t?function(){return null}:t,c=e.onCancel,a=void 0===c?function(){}:c,i=e.onPost,d=void 0===i?function(){}:i,g=e.onContentChange,S=void 0===g?function(){}:g,h=e.className,C=e.author,_=f.wrapComposerComponent(p.draftComposer),v=f.wrapComposerComponent(l.postSignal),y=this.createBaseScope([u.publishReducers({onCancel:a,onPost:d,onContentChange:S})]),E=m(h,{"sc-comment-editor":!0});return n.createElement("div",{className:E},n.createElement(s.BaseScopeComponent,{container:this.container,scope:y},n.createElement("div",{className:"sc-comment-editor-inner"},n.createElement("div",{className:"sc-comment-avatar"},n.createElement(r.CommentAvatar,{user:C})),n.createElement(_,null)),n.createElement(v,{signalComponent:o})))},t})(a.Component);t.CommentEditor=R});
//# sourceMappingURL=comment_editor.min.js-vflx2GsfV.map