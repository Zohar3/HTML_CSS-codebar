define(["require","exports","tslib","external/lodash","external/react","modules/clean/react/css","spectrum_comments/comment_stream","modules/clean/react/comments2/helper","modules/clean/react/comments2/store/selectors","modules/clean/react/comments2/store/types","modules/clean/react/file_sidebar/file_sidebar_connect","modules/clean/react/comments2/store/actions","modules/clean/react/file_viewer/coach_mark","modules/clean/react/file_viewer/more_dropdown/more_option_registry","modules/clean/react/file_action_button","modules/clean/react/file_viewer/more_dropdown/models","modules/clean/previews/constants","modules/clean/video_annotations_prototype/video_annotation_prototype_helper","spectrum_comments/comment/video_comment","spectrum_comments/comment_editor/comment_editor","spectrum_comments/comment_editor/video_comment_editor","modules/clean/video_annotations_prototype/constants","modules/clean/video_annotations_prototype/video_preview_event_emitter","modules/clean/react/comments2/logger","modules/core/i18n","modules/core/user_i18n","modules/clean/uuid"],function(e,o,t,n,r,i,a,s,d,m,c,p,l,u,v,h,_,T,g,C,f,E,w,y,O,b,M){"use strict";function P(e){var o=e.playerCurrentTime,n=e.previewType,i=e.showOnboarding,a=e.onCoachmarkClose;return n===_.PreviewType.Video&&void 0!==o?r.createElement(f.VideoCommentEditor,t.__assign({},e,{currentTime:o,showCoachmark:i,createCoachmark:function(){return r.createElement(l.CoachMark,{title:O._("Target your feedback"),arrowPosition:"top",showClose:!0,onCloseButtonClick:a},O._("Adding time codes to comments keeps feedback simple, organized, and all in one place."))}})):r.createElement(C.CommentEditor,t.__assign({},e))}function S(e){return{activeThreadId:d.getActivatedThreadId(e),mentions:d.getMentionsData(e),playerCurrentTime:d.getPlayerCurrentTime(e),onboardingKeysNotYetMarked:d.getOnboardingKeysNotYetMarked(e),showOnboarding:d.getShowOnboardingOnCommentsPane(e),showResolved:d.getShowResolved(e),threads:d.getThreads(e)}}Object.defineProperty(o,"__esModule",{value:!0});var A=(function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.videoPreviewOnboardingDismissed=function(){o.props.dispatch(p.suppressOnboardingForSession("video_first_paused"))},o.videoPreviewToggled=function(e,t,n){o.props.dispatch(p.recordPausePlay(n))},o.toggleShowResolved=function(){var e=o.props,t=e.dispatch,n=e.showResolved,r=e.viewer,i=e.stream,a=n?"hide_resolved_threads":"show_resolved_threads";t(p.toggleShowResolved()),r&&y.commentLogger.logEvent(r.id,a,i)},o.createEditor=function(e){return P(t.__assign({},e,n.pick(o.props,["playerCurrentTime","previewType","showOnboarding"]),{onCoachmarkClose:o.onCoachmarkClose}))},o.onCoachmarkClose=function(){o.props.dispatch(p.suppressOnboardingForSession("initial_video_land"))},o}return t.__extends(o,e),o.prototype.updateCommentsMoreOptionGroup=function(){var e=this.props.showResolved?v.FileActionButtonType.HIDE_RESOLVED_COMMENTS:v.FileActionButtonType.SHOW_RESOLVED_COMMENTS,o=new h.MoreOptionGroup({fileActionButtonGroup:v.FileActionButtonGroup.COMMENTS,options:[new h.MoreOption({className:"comments-options-item__show-resolved",fileActionButtonType:e,component:function(e){return r.createElement("span",null,e.buttonText)},handler:this.toggleShowResolved})]});void 0===this.moreOptionGroup?u.moreOptionRegistry.addOption(o):u.moreOptionRegistry.replaceOption(this.moreOptionGroup,o),this.moreOptionGroup=o},o.prototype.componentWillMount=function(){var e=this.props,o=e.viewer,t=e.dispatch;o&&t(p.initializeMentionsContacts(o))},o.prototype.componentDidMount=function(){this.updateCommentsMoreOptionGroup(),w.videoPreviewEventEmitter.addListener(E.EventTypes.ONBOARDING_DISMISSED,this.videoPreviewOnboardingDismissed),w.videoPreviewEventEmitter.addListener(E.EventTypes.VIDEO_TOGGLED,this.videoPreviewToggled)},o.prototype.componentDidUpdate=function(){this.updateCommentsMoreOptionGroup()},o.prototype.componentWillUnmount=function(){w.videoPreviewEventEmitter.removeListener(E.EventTypes.ONBOARDING_DISMISSED,this.videoPreviewOnboardingDismissed),w.videoPreviewEventEmitter.removeListener(E.EventTypes.VIDEO_TOGGLED,this.videoPreviewToggled)},Object.defineProperty(o.prototype,"actionsAdapter",{get:function(){var e,o=this,r=this.props,i=r.dispatch,a=r.onboardingKeysNotYetMarked,d=r.mentions,c=r.stream,l=r.viewer,u={onClickTimeCode:function(e){var o=T.VideoAnnotationPrototypeHelper.unitConvertDomainObjectTimeToSeconds(e);w.videoPreviewEventEmitter.emit(E.EventTypes.SEEK_POSITION_AND_PAUSE,o)},onEditorFocused:function(e){w.videoPreviewEventEmitter.emit(E.EventTypes.PAUSE)},onThreadActivated:function(e){if(i(p.activateThread(e)),!e.read&&l&&i(p.markThreadRead(l,c,e.id,m.MarkThreadReadOrigin.ThreadActivated)),e.annotation){var o=T.VideoAnnotationPrototypeHelper.unitConvertDomainObjectTimeToSeconds(e.annotation.time);w.videoPreviewEventEmitter.emit(E.EventTypes.SEEK_POSITION_AND_PAUSE,o)}}};return e=l?{onThreadCreated:function(e,n){var r=s.Comments2Helper.commentContentToUserSubmittedComment(e,c);n&&(r.annotation_data=t.__assign({".tag":"video"},n));var d=M.v4();i(p.addComment({user:l,author:o.viewerAsIUser(l),stream:c,comment:r,content:e,guid:d,annotation:n})).then(function(){if(n&&a.length)for(var e=0,o=a;e<o.length;e++){var t=o[e];i(p.markOnboarded(l,t))}})},onThreadRepliedTo:function(e,t){var n=s.Comments2Helper.commentContentToUserSubmittedComment(t,c),r=M.v4();i(p.addComment({user:l,author:o.viewerAsIUser(l),stream:c,comment:n,content:t,threadId:e,guid:r}))},onThreadMarkedAsRead:function(e){i(p.markThreadRead(l,c,e,m.MarkThreadReadOrigin.UIButtonClicked))},onThreadMarkedAsUnread:function(e){i(p.markThreadUnread(l,c,e))},onThreadResolved:function(e){i(p.markThreadResolved(l,c,e))},onThreadUnresolved:function(e){i(p.markThreadUnresolved(l,c,e))},onCommentEdited:function(e,o){i(p.editComment(l,c,e,o))},onCommentDeleted:function(e){i(p.deleteComment(l,c,e))},onMentionsQueryUpdated:function(e){var o=function(o){i(p.mentionsMatchesUpdate(e,o))};d.contactsManager.search(e,o,o)}}:{onThreadCreated:n.noop,onThreadRepliedTo:n.noop,onThreadMarkedAsRead:n.noop,onThreadMarkedAsUnread:n.noop,onThreadResolved:n.noop,onThreadUnresolved:n.noop,onCommentEdited:n.noop,onCommentDeleted:n.noop,onMentionsQueryUpdated:n.noop},t.__assign({},u,e)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"commentComponent",{get:function(){return this.props.previewType===_.PreviewType.Video?g.VideoComment:void 0},enumerable:!0,configurable:!0}),o.prototype.viewerAsIUser=function(e){return{id:e.account_id,name:{display:e.display_name,initials:b.getInitials(e.display_name),public:b.getShortName(e.display_name)},photoUrl:e.photo_circle_url}},o.prototype.render=function(){var e=this.props,o=e.showResolved,t=e.stream,n=e.viewer,i=e.mentions,s=e.activeThreadId;if(n&&!i.contactsManager)return null;var d,m=this.props.threads.filter(function(e){return o||!e.resolved});return n&&(d=this.viewerAsIUser(n)),r.createElement("div",null,r.createElement(a.CommentStream,{id:t.id,actionsAdapter:this.actionsAdapter,commentComponent:this.commentComponent,editorComponent:this.createEditor,enabled:!0,isMobile:!1,mentionsMatches:i.matches,settings:{canAnnotate:!0,canComment:!0,canRead:!0},userPermissions:{canAnnotate:!0,canComment:!0,canRead:!0},threads:m,user:d,initialActiveThreadID:s}))},o})(r.Component);o.UnconnectedCommentsPane=A;var k=i(c.fileSidebarConnect(S)(A),["/static/js/spectrum_comments/index.web-vfl8UJDvv.css"]);o.CommentsPane=k});
//# sourceMappingURL=comments_pane.min.js-vflQtkTGO.map