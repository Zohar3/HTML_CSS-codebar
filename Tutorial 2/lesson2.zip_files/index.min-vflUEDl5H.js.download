define(["require","exports","spectrum_comments/comment_editor/reducers/macros/draft","spectrum_comments/comment_editor/reducers/macros/macro","spectrum_comments/comment_editor/macros/mentions_macro_composers","spectrum_comments/comment_editor/core/composer_wrappers","spectrum_comments/comment_editor/components/mention_suggestions_list","spectrum_comments/comment_editor/components/mention_decorator","spectrum_comments/comment_editor/draft_utils","draft-js"],function(e,t,n,o,r,i,s,c,m,a){"use strict";function u(e){var t=e.innerProps,n=t.text,o=t.offset,r=t.delimiter,i=t.input;if((o+i.length-r.length===0||" "===n.substr(o-r.length,1))&&n.substring(o-r.length+1,o)+i===r)return{start:o,end:o+r.length,text:i}}function d(e){var t=e.kernel.compose(u,e.innerProps);if(t)return t;var n=e.innerProps,o=n.text,r=n.delimiter,i=n.offset,s=n.input,c=o.substr(0,i).match(/[^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*$/);return null!==c?{start:i-c[0].length,end:i+r.length,text:c[0]+s}:void 0}function p(e){return Object.keys(e).map(function(t){var r=e[t],i=r.onMacro,s=void 0===i?function(){}:i,c=r.type,m=void 0===c?"macro: "+t:c,a=r.spanProps,d=void 0===a?{}:a,p=r.macroDecorators,l=void 0===p?[]:p,f=r.onAutoComplete,g=r.onDelimiter,v=void 0===g?u:g;return{draft:{values:n.createDraftValuesReducers(m,t,d,s,v,l)},macro:{evts:o.createMacroEventReducers(m,f),values:o.createMacroValuesReducers(m,s)}}})}function l(e){window.setTimeout(function(){f(e)},0)}function f(e){function t(e,t,n,r,s){var d=u.createEntity("mention","IMMUTABLE",{identifier:e,type:t}),p=d.getLastCreatedEntityKey(),l=m.replaceText(d,c.active.blockKey,r,s,"@"+n,p);i.draft.change(m.replaceContent(o.draft.editorState,a.Modifier.insertText(l,l.getSelectionAfter()," ")))}function n(e){return c.active.entityKey===e.getEntity()}var o=e.status,i=e.scopeTriggers,s=o.draft,c=o.macro,u=(o.mentionSuggestions,o.suggestion,s.editorState.getCurrentContent()),d=u.getBlockForKey(c.active.blockKey),p=e.kernel.compose(r.getSelectedUser);p?d.findEntityRanges(n,t.bind(null,p.id,"id",p.name.display)):m.parseEmail(c.active.content)&&d.findEntityRanges(n,t.bind(null,c.active.content,"email",c.active.content))}Object.defineProperty(t,"__esModule",{value:!0});var g={strategy:function(e,t,n){e.findEntityRanges(function(e){var t=e.getEntity();return null!==t&&"mention"===n.getEntity(t).getType()},t)},component:c.MentionDecorator};t.macrosReducers=function(e){var t=e.onMentionSuggestionsQuery;return p({"@":{onDelimiter:d,onMacro:i.bindComposer(r.mentionsMacroComposer,{onMentionSuggestionsQuery:t}),spanProps:{className:"active-mention",chrome:i.wrapComposerComponent(s.mentionSuggestionsListComposer)},macroDecorators:[g],onAutoComplete:l}})}});
//# sourceMappingURL=index.min.js-vfl5J6KqH.map