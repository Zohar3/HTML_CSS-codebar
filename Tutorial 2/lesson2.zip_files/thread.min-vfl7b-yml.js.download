define(["require","exports","tslib","react","classnames","spectrum/checkbox","spectrum/tertiary_link","spectrum_comments/comment","spectrum_comments/thread/thread_editor","spectrum_comments/users_to_notify/users_to_notify"],function(e,t,n,r,o,i,s,a,c,d){"use strict";function m(e){var t=e.count,n=t>1?t+" comments":t+" comment";return r.createElement("div",{className:"sc-thread-comment-number"},n)}function l(e,t){return{onDeleted:function(){return t.onCommentDeleted(e.id)},onEdited:function(n){return t.onCommentEdited(e.id,n)},onMentionsQueryUpdated:t.onMentionsQueryUpdated,onClickTimeCode:t.onClickTimeCode}}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){},p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isEditorEmpty:!0},t.onEditorCancel=t.props.onCancel,t.onEditorContentChange=function(e){var n=e.isEmpty;e.isFocused&&t.props.actions.onEditorFocused(),t.setState({isEditorEmpty:n})},t.onEditorPost=t.props.actions.onReply,t.onMentionsQueryUpdated=t.props.actions.onMentionsQueryUpdated,t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.props.active&&this.ref&&(this.ref&&this.ref.scrollIntoView&&this.ref.scrollIntoView(),this.props.onActivated())},Object.defineProperty(t.prototype,"active",{get:function(){return this.props.active||!this.state.isEditorEmpty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){var e=this.props,t=e.className,n=void 0===t?"":t,r=e.thread;return o(n,{"sc-thread":!0,"sc-thread-active":this.active,"sc-thread-inactive":!this.active,"sc-thread-read":r.read,"sc-thread-unread":!r.read,"sc-thread-resolved":r.resolved,"sc-thread-unresolved":!r.resolved})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filteredReplies",{get:function(){var e=this.props.thread.comments;e[0];return e.slice(1).filter(function(e){return!e.deleted})},enumerable:!0,configurable:!0}),t.prototype.renderComment=function(e,t,n,o){void 0===n&&(n=a.Comment);var i=this.props,s=i.actions,c=i.editedComment,d=i.mentionsMatches,m=(i.onStartEdit,i.onEndEdit,!!c&&e.id===c.id);return r.createElement(n,{actions:l(e,s),active:t,annotation:o,comment:e,key:e.id,isEditing:m,onStartEdit:this.props.onStartEdit,onEndEdit:this.props.onEndEdit,mentionsMatches:d})},t.prototype.renderResolveControl=function(){var e=this.props,t=e.actions,n=e.thread,o=n.resolved?"Resolved":"Resolve",s=n.resolved?r.createElement(i.Checkbox,{checked:"checked",onChange:function(){return t.onUnresolve()}}):r.createElement(i.Checkbox,{checked:"unchecked",onChange:function(){return t.onResolve()}});return r.createElement("label",{className:"sc-thread-controls-resolve"},s,o)},t.prototype.renderReadToggle=function(){var e=this.props,t=e.actions,n=e.thread,o=n.read?t.onMarkAsUnread:t.onMarkAsRead,i=n.read?"Mark as unread":"Mark as read";return r.createElement(s.TertiaryLink,{className:"sc-thread-read-toggle",onClick:o},i)},t.prototype.renderToplineControls=function(){return this.props.user?r.createElement("div",{className:"sc-thread-controls"},this.renderResolveControl(),this.renderReadToggle()):null},t.prototype.renderActive=function(){var e,t=this,n=this.props,o=(n.actions,n.commentComponent),i=n.mentionsMatches,s=n.thread,m=n.user,l=n.isMobile,u=this.filteredReplies,p=null;if(m){p=r.createElement(c.ThreadEditor,{author:m,mentionsMatches:i,onCancel:this.onEditorCancel,onContentChange:this.onEditorContentChange,onMentionsQueryUpdated:this.onMentionsQueryUpdated,onPost:this.onEditorPost});var h=s.comments.filter(function(e){return!e.deleted}).map(function(e){return e.author}),f=h.filter(function(e,t,n){return n.indexOf(e)===t}).filter(function(e){return e.id!==m.id});e=r.createElement(d.UsersToNotify,{users:f})}return r.createElement("li",{className:"sc-thread-container",ref:function(e){return t.ref=e}},r.createElement("div",{className:this.className},this.renderToplineControls(),r.createElement("ul",{className:"sc-thread-comments"},this.renderComment(s.comments[0],this.active,o,s.annotation),u.map(function(e){return t.renderComment(e,!0,a.Comment)})),!l&&p),!l&&e)},t.prototype.renderInactive=function(){var e=this.props,t=e.active,n=e.commentComponent,o=void 0===n?a.Comment:n,i=e.mentionsMatches,s=e.onActivated,c=e.thread,d=this.filteredReplies;return r.createElement("li",{className:"sc-thread-container",tabIndex:0,onClick:s},r.createElement("div",{className:this.className},r.createElement("ul",{className:"sc-thread-comments"},this.renderComment(c.comments[0],t,o,c.annotation),d.length>1&&r.createElement(m,{count:d.length-1}),d.length>0&&r.createElement(a.Comment,{active:!1,comment:d[d.length-1],actions:{onClickTimeCode:u,onDeleted:u,onEdited:u,onMentionsQueryUpdated:u},mentionsMatches:i,onEndEdit:u,onStartEdit:u,isEditing:!1}))))},t.prototype.render=function(){return this.props.thread.comments.every(function(e){return!!e.deleted})?null:this.active?this.renderActive():this.renderInactive()},t})(r.PureComponent);t.Thread=p});
//# sourceMappingURL=thread.min.js-vflHtgCE4.map